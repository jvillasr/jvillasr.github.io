{%- assign p = include.project -%}

{%- assign is_abs = p.link | downcase | contains: '://' -%}
{%- assign is_same_origin = false -%}
{%- if is_abs and site.url and p.link contains site.url -%}
  {%- assign is_same_origin = true -%}
{%- endif -%}
{%- assign is_internal = is_abs == false or is_same_origin -%}

{%- comment -%} Normalize internal absolute links to relative {%- endcomment -%}
{%- if is_internal and is_abs -%}
  {%- assign normalized_href = p.link | replace: site.url, '' -%}
{%- else -%}
  {%- assign normalized_href = p.link -%}
{%- endif -%}

<a class="card research-card"
   href="{% if is_internal %}{{ normalized_href | relative_url }}{% else %}{{ p.link }}{% endif %}"
   {% unless is_internal %}target="_blank" rel="noopener"{% endunless %}
   aria-label="{{ p.name | escape }}"
>
  <div class="image is-3by2 research-card-media"
       {% if p.image %}
         {%- assign img_abs = p.image | downcase | contains: '://' -%}
         {%- assign img_src = img_abs ? p.image : p.image | relative_url -%}
         style="background-image:url('{{ img_src }}')"
       {% endif %}>
    <span class="sr-only">{{ p.image_alt | default: p.name }}</span>
  </div>

  <div class="card-content has-text-centered has-background-black">
    <h3 class="title is-5 has-text-white research-card-title">{{ p.name }}</h3>
    <p class="has-text-white has-text-weight-light research-card-desc">
      {{ p.description }}
    </p>

    {% if p.role or p.status %}
      <div class="research-card-badges">
        {% if p.role %}<span class="tag is-light research-card-tag">{{ p.role }}</span>{% endif %}
        {% if p.status %}<span class="tag is-dark research-card-tag">{{ p.status }}</span>{% endif %}
      </div>
    {% endif %}
  </div>
</a>